<!DOCTYPE html>
<html>
<head>
    <title>EchoNest â€” Stats</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { background: #111; color: #e0e0e0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 24px; }
        h1 { font-size: 22px; margin-bottom: 24px; color: #fff; }
        h2 { font-size: 16px; margin-bottom: 12px; color: #aaa; text-transform: uppercase; letter-spacing: 1px; }
        a { color: #6cf; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .back { display: inline-block; margin-bottom: 16px; font-size: 13px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; margin-bottom: 32px; }
        .card { background: #1a1a1a; border-radius: 8px; padding: 16px; }
        .card .value { font-size: 28px; font-weight: 700; color: #fff; }
        .card .label { font-size: 12px; color: #888; margin-top: 4px; }
        .chart { display: flex; align-items: flex-end; gap: 6px; height: 120px; margin-bottom: 32px; }
        .bar-wrapper { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .bar { width: 100%; background: #2a6; border-radius: 4px 4px 0 0; min-height: 2px; transition: height 0.3s; }
        .bar-label { font-size: 10px; color: #888; margin-top: 4px; white-space: nowrap; }
        .bar-count { font-size: 11px; color: #ccc; margin-bottom: 2px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 32px; }
        th { text-align: left; font-size: 12px; color: #888; padding: 8px 12px; border-bottom: 1px solid #333; text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: 8px 12px; border-bottom: 1px solid #222; font-size: 13px; }
        .num { text-align: right; font-variant-numeric: tabular-nums; }
        .me { color: #2a6; font-weight: 600; }
    </style>
</head>
<body>
    <a href="/" class="back">&larr; back to EchoNest</a>
    <h1>EchoNest Stats</h1>

    <h2>Today at a Glance</h2>
    <div class="grid">
        <div class="card">
            <div class="value">{{ dau_count }}</div>
            <div class="label">Active Users</div>
        </div>
        <div class="card">
            <div class="value">{{ today.get('song_add', 0) }}</div>
            <div class="label">Songs Queued</div>
        </div>
        <div class="card">
            <div class="value">{{ today.get('vote', 0) }}</div>
            <div class="label">Votes</div>
        </div>
        <div class="card">
            <div class="value">{{ today.get('jam', 0) }}</div>
            <div class="label">Jams</div>
        </div>
        <div class="card">
            <div class="value">{{ today.get('airhorn', 0) }}</div>
            <div class="label">Airhorns</div>
        </div>
        <div class="card">
            <div class="value">{{ today.get('signup', 0) }}</div>
            <div class="label">Signups</div>
        </div>
        <div class="card">
            <div class="value">{{ today.get('song_finish', 0) }}</div>
            <div class="label">Songs Played</div>
        </div>
        <div class="card">
            <div class="value">{{ known_users }}</div>
            <div class="label">Total Users</div>
        </div>
    </div>

    <h2>Daily Active Users (7 days)</h2>
    {% set max_dau = dau_trend|map(attribute=1)|max or 1 %}
    <div class="chart">
        {% for date, count in dau_trend %}
        <div class="bar-wrapper">
            <div class="bar-count">{{ count }}</div>
            <div class="bar" style="height: {{ (count / max_dau * 100)|int }}%;"></div>
            <div class="bar-label">{{ date[5:] }}</div>
        </div>
        {% endfor %}
    </div>

    <h2>You vs Everyone Else (7 days)</h2>
    <table>
        <thead>
            <tr>
                <th></th>
                <th class="num">Songs</th>
                <th class="num">Votes</th>
                <th class="num">Jams</th>
                <th class="num">Airhorns</th>
                <th class="num">Sessions</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td class="me">You</td>
                <td class="num me">{{ my_stats.get('song_add', 0) }}</td>
                <td class="num me">{{ my_stats.get('vote', 0) }}</td>
                <td class="num me">{{ my_stats.get('jam', 0) }}</td>
                <td class="num me">{{ my_stats.get('airhorn', 0) }}</td>
                <td class="num me">{{ my_stats.get('ws_connect', 0) }}</td>
            </tr>
            <tr>
                <td>Others ({{ others_count }})</td>
                <td class="num">{{ others_stats.get('song_add', 0) }}</td>
                <td class="num">{{ others_stats.get('vote', 0) }}</td>
                <td class="num">{{ others_stats.get('jam', 0) }}</td>
                <td class="num">{{ others_stats.get('airhorn', 0) }}</td>
                <td class="num">{{ others_stats.get('ws_connect', 0) }}</td>
            </tr>
        </tbody>
    </table>
</body>
</html>
